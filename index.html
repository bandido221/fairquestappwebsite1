<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FairQuest | Discover Renaissance Fairs FairQuest App | Renaissance Fair Finder & Festival Companion</title>

    <!-- Google verification for AdSense -->
  <meta name="google-adsense-account" content="ca-pub-3110601517763616">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500&family=Domine&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HP222J86X0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-HP222J86X0');
  </script>

 <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3110601517763616"
     crossorigin="anonymous"></script>

  <style>
    body {
      font-family: 'Domine', serif;
      background-color: #000;
      color: #f0e6d2;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header { padding: 20px; }
    .top-banner {
      width: 100%;
      max-width: 600px;
      display: block;
      margin: 0 auto 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .logo {
      width: 120px;
      display: block;
      margin: 0 auto 20px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
    }
    h1 {
      font-family: 'Cinzel', serif;
      font-size: 2.5rem;
      margin: 20px 0;
    }
    p {
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto 30px auto;
      padding: 0 10px;
    }
    .button-group {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 40px;
    }
    .btn {
      background-color: #bb9457;
      color: black;
      font-weight: bold;
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      text-decoration: none;
    }
    .btn:hover {
      background-color: #d2b277;
    }
    footer {
      font-size: 0.8rem;
      padding: 20px;
      color: #aaa;
    }
    footer a {
      color: #aa8452;
      text-decoration: none;
      margin: 0 8px;
    }
    footer a:hover { text-decoration: underline; }
    .social-icons {
      margin-top: 20px;
    }
    .social-icons a {
      display: inline-block;
      margin: 0 10px;
      color: #f0e6d2;
      font-size: 24px;
      transition: color 0.3s;
    }
    .social-icons a:hover {
      color: #bb9457;
    }
   @media (max-width: 768px) {
  header { padding: 40px 10px; }
  h1 { font-size: 2rem; }
  .btn { margin-top: 10px; } /* no forced full width */
  .button-group { flex-direction: column; align-items: center; }
}


    .explore-btn {
  font-size: 1.3rem;
  padding: 16px 32px;
  background-color: #d4af37; /* gold highlight */
}
.explore-btn:hover {
  background-color: #e6c85c;
}

.top-menu a {
  color: #f0e6d2;
  font-family: 'Cinzel', serif;
  font-size: 1rem;
  text-decoration: none;
  font-weight: bold;
  padding: 6px 10px;
}

.top-menu a:hover {
  color: #d4af37;
}

body {
  padding-top: 70px; /* push page down so menu does NOT overlap content */
}
.top-menu {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: #111;
  padding: 10px 12px;
  display: flex;
  flex-direction: column;   /* ‚≠ê FORCE 2 ROWS ALWAYS */
  align-items: center;
  z-index: 9999;
  border-bottom: 2px solid #bb9457;
}

.menu-row-1 {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.menu-left,
.menu-right {
  display: flex;
  flex-direction: row;
  gap: 8px;
}

.menu-email-bar {
  width: 100%;
  text-align: center;
  margin-top: 4px;
  font-size: 0.9rem;
  font-weight: bold;
  color: #d4af37;
}

/* ‚≠ê MOBILE FONT SHRINK */
@media (max-width: 768px) {
  .menu-left a,
  .menu-right a {
    font-size: 0.85rem;
    padding: 4px 8px;
  }
}

.menu-left a,
.menu-right a {
  color: #f0e6d2;
  font-family: 'Cinzel', serif;
  font-size: 1rem;
  text-decoration: none;
  padding: 6px 12px;
  border-radius: 6px;
  font-weight: bold;
}

.menu-left a:hover,
.menu-right a:hover {
  background-color: #bb9457;
  color: #000;
}

.menu-btn {
  background-color: #333;
  border: 1px solid #bb9457;
}

body {
  padding-top: 75px; 
}

  </style>
</head>

<body>

  <!-- FIXED TOP MENU BAR -->
<div class="top-menu">

  <!-- ROW 1 -->
  <div class="menu-row-1">
    <div class="menu-left">
      <a class="menu-btn" href="/fairs/explore.html">üîç Fairs</a>
    </div>

    <div class="menu-right" id="menuRight"></div>
  </div>

  <!-- ROW 2 EMAIL BAR (JS will fill it) -->
  <div id="menuEmail" class="menu-email-bar"></div>

</div>

  <img src="images/banner.png" alt="FairQuest Banner" class="top-banner" />

  <header>
    <img src="images/logo.png" alt="FairQuest Logo" class="logo" />
    <h1>Welcome to FairQuest</h1>
    <p>
      Your gateway to magical weekends! Discover upcoming Renaissance fairs, apply as a vendor or performer,
      and join our growing community of fairgoers.
    </p>
    <p>FairQuest is the ultimate Renaissance festival companion. Whether people call it ‚ÄúFair Quest,‚Äù ‚ÄúFairQuest app,‚Äù
      or ‚ÄúFair Quest festival finder,‚Äù this is the place to discover, apply, and attend your favorite renfairs.</p>
  <section style="max-width:760px; margin:20px auto; padding:0 18px; text-align:left;">
  <h2 style="font-family:'Cinzel',serif; margin-bottom:10px; font-size:1.5rem;">
    Find Fairs Near You
  </h2>
  <p>
    Looking for fairs around you? FairQuest is designed to help you <strong>find Renaissance fairs near me</strong>,
    discover upcoming festivals, and explore events happening in your state or region. Whether you search for 
    <strong>‚Äúfind fairs‚Äù</strong>, <strong>‚Äúfairs around me‚Äù</strong>, or <strong>‚ÄúRenaissance fairs near me‚Äù</strong>, 
    FairQuest makes it easy to locate accurate dates, locations, maps, and official links for every event.
  </p>
  <p>
    Our fair finder directory covers the entire United States and is constantly updated with new festival dates, 
    vendor applications, performer opportunities, and local event announcements. If a fair is happening near you, 
    FairQuest helps you find it fast.
  </p>
</section>

    </header>

    <div class="button-group">
    <!--
    <a class="btn" href="/dowload_app.html">
      üì≤ Download App
    </a>
    -->
    <a class="btn explore-btn" id="exploreBtn" href="/fairs/explore.html" onclick="trackExploreFairs(event)">üé™ Explore Fairs</a>
    <a class="btn" id="vendorButton" href="#" onclick="requireLoginAndRedirect('vendor_performer/vendor/application.html')">üß∫ Apply as Vendor</a>
    <a class="btn" id="performerButton" href="#" onclick="requireLoginAndRedirect('vendor_performer/performer/application.html')">üé≠ Apply as Performer</a>
    <a class="btn" id="foodVendorButton" href="#" onclick="requireLoginAndRedirect('food_vendor/apply_food_vendor.html')">üçî Apply as Food Vendor</a>
    <a class="btn" href="/how_to/help_center.html">‚ùì Help Center</a>
   </div>

<!-- Fairs Around You -->
<div id="nearbyFairsCard"
     style="background:#1b1b1b; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.6);
            margin:20px auto 40px auto; padding:28px; max-width:700px; text-align:center; color:#f0e6d2;">

  <h2 style="font-family:'Cinzel',serif; font-size:1.6rem; margin:0 0 6px 0;">
    üìç Fairs Around You
  </h2>

<div id="locationStatus"
     style="font-size:0.95rem; color:#d4af37; margin-bottom:14px;">
  <span style="font-weight:bold;">Near:</span>
  <span id="locationLabel">Detecting‚Ä¶</span>
</div>



  <!-- Location override form (hidden by default) -->
  <div id="locationForm"
       style="display:none; margin-bottom:18px; background:#111;
              padding:14px; border-radius:10px;">

    <p style="margin:0 0 10px 0; font-weight:bold;">
      Set your location
    </p>

    <input id="zipInput"
           type="text"
           placeholder="ZIP code"
           style="width:120px; padding:8px; margin:4px; border-radius:6px; border:none;" />

    <span style="margin:0 6px;">or</span>

    <input id="cityInput"
           type="text"
           placeholder="City"
           style="width:140px; padding:8px; margin:4px; border-radius:6px; border:none;" />

    <input id="stateInput"
           type="text"
           placeholder="State (FL)"
           maxlength="2"
           style="width:70px; padding:8px; margin:4px; border-radius:6px; border:none;" />

    <div style="margin-top:10px;">
      <button onclick="applyManualLocation()"
              style="padding:8px 16px; border-radius:8px;
                     border:none; background:#d4af37; font-weight:bold; cursor:pointer;">
        Apply
      </button>
    </div>
  </div>

  <div style="margin:0 0 8px 0; color:#aaa;">
  <label for="radiusSelect" style="margin-right:8px;">Distance:</label>
<select id="radiusSelect"
        style="padding:8px 10px; border-radius:8px; border:none; font-weight:bold;">
  <option value="50" selected>50 miles</option>
  <option value="75">75 miles</option>
  <option value="100">100 miles</option>
  <option value="200">200 miles</option>
</select>


</div>
<p id="nearbyFairsMessage" style="margin:14px 0 0 0;">
  Waiting for location‚Ä¶
</p>

<div id="nearbyFairsResults" style="margin-top:14px;"></div>

</div>

<script>
function toggleLocationForm() {
  const form = document.getElementById('locationForm');
  form.style.display = (form.style.display === 'none') ? 'block' : 'none';
}

function applyManualLocation() {
  const zip = document.getElementById('zipInput').value.trim();
  const city = document.getElementById('cityInput').value.trim();
  const state = document.getElementById('stateInput').value.trim().toUpperCase();

  if (!zip && !(city && state)) {
    alert('Enter a ZIP code or City + State');
    return;
  }

  document.getElementById('locationStatus').innerHTML =
    `Using manual location
     <button onclick="toggleLocationForm()"
             style="margin-left:10px; padding:4px 10px; border-radius:6px;
                    border:none; cursor:pointer; font-weight:bold;">
       Change
     </button>`;

  document.getElementById('nearbyFairsMessage').innerText =
    'Location set. Searching nearby fairs‚Ä¶';

  document.getElementById('locationForm').style.display = 'none';

    // Trigger manual flow (zip OR city/state)
  window.__manualLocation = { zip, city, state };
  loadNearbyFairsCard({ source: "manual" });

}
</script>


<!-- Dynamic Spotlight Card -->
<div id="spotlightCard"
     style="background:#222; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.6);
            margin:40px auto; padding:28px; max-width:700px; text-align:center; color:#f0e6d2;">
  Loading featured vendor/performer...
</div>





 <!-- Fair of the Month Card -->
<div style="background:#1b1b1b; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.6); margin:40px auto; padding:28px; max-width:700px; text-align:center; color:#f0e6d2;">
  <h2 style="font-family:'Cinzel',serif; font-size:1.6rem; margin-bottom:12px;">üè∞ Fair of the Month</h2>
  <p style="font-size:1.2rem; margin-bottom:12px; color:#d4af37; font-weight:bold;">
    Hot Springs Renaissance Faire
  </p>
  <p style="font-size:1rem; max-width:600px; margin:0 auto 18px auto;">
    Immerse yourself in the magic of the <strong>Hot Springs Renaissance Faire</strong> ‚Äî Arkansas‚Äô longest-running Renaissance faire, filled with revelry, artisans, jousts and feasts!
  </p>

  <!-- Live Website Preview -->
  <div style="width:100%; height:420px; border-radius:10px; overflow:hidden; margin-bottom:20px;">
    <iframe 
      src="https://www.hsrenfaire.org/" 
      style="width:100%; height:100%; border:none;" 
      loading="lazy">
    </iframe>
  </div>

  <p style="font-size:1rem; max-width:600px; margin:0 auto 12px auto;">
    Whether you're visiting, performing, or vending, the Hot Springs Renaissance Faire offers an unforgettable weekend of merriment and community. Join us and be part of the enchantment.
  </p>

  <a href="https://www.hsrenfaire.org/" target="_blank" 
     style="display:inline-block; margin-top:6px; padding:12px 20px; background-color:#d4af37; color:#000; font-weight:bold; border-radius:8px; text-decoration:none;">
    üéüÔ∏è Visit Website
  </a>
</div>




  <!-- About & Value Content (added above ads for AdSense) -->
  <section id="about-fairquest" style="max-width: 760px; margin: 36px auto; padding: 0 18px; text-align: left;">
    <h2 style="font-family:'Cinzel',serif; margin:0 0 12px 0; font-size:1.7rem;">What FairQuest Actually Does</h2>
    <p>
      FairQuest is a practical tool for finding Renaissance fairs and planning a visit. We maintain a
      growing index of fairs with dates, location details, web links, and application links for
      vendors, performers, and food vendors. Each listing aims to answer the basics quickly:
      <em>when it runs, where it is, and who to contact</em>.
    </p>
    <p>
      For organizers, we provide direct application paths (vendor, performer, food) and a way to keep
      their information current. For visitors, we focus on clear maps, simple schedules, and
      mobile-friendly pages that load fast.
    </p>
    <p>
      This site is edited manualy. When we don‚Äôt have an official source, we label it, and we replace
      info as soon as organizers publish updates. If you spot an error or your fair is missing, tell us:
      we fix records, not just pages.
    </p>
<section style="max-width:760px;margin:40px auto;padding:0 18px;text-align:left;">
  <h2 style="font-family:'Cinzel',serif;margin-bottom:12px;font-size:1.7rem;">How To Apply as a Vendor or Performer</h2>
  <p>
    Vendors and performers can apply directly through FairQuest using the buttons on the main page. 
    Each option‚ÄîVendor, Performer, or Food Vendor‚Äîopens its own short form. Once the form is submitted, 
    your application goes to review. After approval, your profile and booth details automatically appear 
    under the fairs you selected, so visitors can find you when they search those fairs.
  </p>
  <p>
    Before applying, make sure to <strong>sign up</strong> and verify your email. Verified accounts help us 
    confirm who is managing each listing. After you log in, the system keeps track of your applications so 
    you can check their status any time. Just click <em>Log In</em> at the bottom of the page, and you‚Äôll 
    see an ‚ÄúApplications‚Äù link showing where you‚Äôve applied and what‚Äôs been approved.
  </p>
  <p>
    If you need to add a new fair that isn‚Äôt listed yet, you can submit it during your application. 
    Our review team checks each entry to keep information accurate for everyone.
  </p>
</section>

    <div style="margin-top:14px; text-align:center;">
      <a href="/fairs/explore.html" class="btn explore-btn" style="display:inline-block; margin:6px;">Explore Fairs</a>
      <a href="/how_to/help_center.html" class="btn" style="display:inline-block; margin:6px;">Help Center</a>
      <a href="/faq.html" class="btn" style="display:inline-block; margin:6px;">FAQ</a>
    </div>
  </section>
<!-- Featured Fairs Directory Preview -->
<section style="max-width:760px; margin:40px auto; padding:0 18px; text-align:left;">
  <h2 style="font-family:'Cinzel',serif; margin-bottom:12px; font-size:1.7rem;">Featured Fairs Directory Preview</h2>
  <p>
    Here‚Äôs a glimpse of fairs listed in the FairQuest directory. Each event includes verified details from organizers‚Äîdates, locations, and contact links. 
    For the full directory, visit the <a href="/fairs/explore.html" style="color:#d4af37;">Explore Fairs</a> page.
  </p>
  <ul style="list-style-type:none; padding:0; line-height:1.6;">
    <li><strong>Hot Springs Renaissance Faire</strong> ‚Äì Arkansas ‚Äì November 2025 ‚Äì <a href="https://www.hsrenfaire.org/" target="_blank" style="color:#d4af37;">hsrenfaire.org</a></li>
    <li><strong>Texas Renaissance Festival</strong> ‚Äì Magnolia, TX ‚Äì Oct‚ÄìDec 2025 ‚Äì <a href="https://www.texrenfest.com/" target="_blank" style="color:#d4af37;">texrenfest.com</a></li>
    <li><strong>Minnesota Renaissance Festival</strong> ‚Äì Shakopee, MN ‚Äì Aug‚ÄìSept 2025 ‚Äì <a href="https://www.renaissancefest.com/" target="_blank" style="color:#d4af37;">renaissancefest.com</a></li>
  </ul>
  <p style="margin-top:12px;">
    We‚Äôre constantly expanding our listings to cover more fairs across the U.S. and beyond. If your event isn‚Äôt here yet, 
    you can <a href="/how_to/help_center.html" style="color:#d4af37;">submit it for inclusion</a> through the FairQuest vendor or performer application portal.
  </p>
</section>
<section style="max-width:760px;margin:40px auto;padding:0 18px;text-align:left;">
  <h2 style="font-family:'Cinzel',serif;margin-bottom:12px;font-size:1.7rem;">Behind FairQuest</h2>
  <p>
    FairQuest was created by Renaissance-fair enthusiasts who wanted one reliable source
    for discovering events, performers, and merchants across the country.
    Our small team verifies fair listings manually, adds new vendors weekly,
    and keeps information fresh so you can plan your magical weekends with confidence.
  </p>
  <p>
    Each update you see on this site represents direct communication with event organizers,
    crafters, and performers who make the fairs come alive. We believe every artisan
    and entertainer deserves to be found easily ‚Äî and FairQuest helps make that happen.
  </p>
</section>

  <!-- Google AdSense Banner: HomepageBanner with fallback -->
  <div id="ad-container" style="max-width:700px; margin:0 auto;">

    <ins class="adsbygoogle"
         style="display:block; text-align:center; min-height:90px;"
         data-ad-client="ca-pub-3110601517763616"
         data-ad-slot="4178733051"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
 
  </div>


  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>



  <div id="earlyTesterCard" style="margin: 40px auto; padding: 30px; background: #bdaa64; color: #3b1f1f; max-width: 700px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); text-align: center;">
    Loading rewards...
  </div>



  <footer>
    <a href="terms.html">Terms</a> |
    <a href="privacy.html">Privacy</a> |
    <a href="contact.html">Contact</a> |
    <a href="faq.html">FAQ</a> |
    <a href="/admin/admin_login.html" style="color: #aa8452; font-style: italic;">üóùÔ∏è Backstage Pass</a>

    <div class="social-icons">
      <a href="https://www.facebook.com/fairquestapp/" target="_blank" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
      <a href="https://www.instagram.com/YourFairQuestPage" target="_blank" aria-label="Instagram"><i class="fa fa-instagram"></i></a>
    </div>

    <p>If you're searching for the Fair Quest app ‚Äî you're in the right place!</p>
  </footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<style>
#resetPasswordModal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
#resetPasswordModal .modal-content {
  background: #fdf7e1;
  color: #3b1f1f;
  padding: 30px;
  border-radius: 10px;
  max-width: 400px;
  text-align: center;
}
#resetPasswordModal input {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  margin-bottom: 20px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
#resetPasswordModal button {
  padding: 12px 20px;
  background: #b73239;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
</style>

<div id="resetPasswordModal">
  <div class="modal-content">
    <h3>Set Your Password</h3>
    <p>Create a new password for your FairQuest account:</p>

    <div style="position: relative;">
      <input type="password" id="newPassword" placeholder="New password" />
      <span onclick="togglePassword('newPassword')" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;">üëÅÔ∏è</span>
    </div>

    <div style="position: relative; margin-top: 10px;">
      <input type="password" id="confirmPassword" placeholder="Confirm password" />
      <span onclick="togglePassword('confirmPassword')" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;">üëÅÔ∏è</span>
    </div>

    <button onclick="submitNewPassword()">Set Password</button>
  </div>
</div>

<script>
// TOP MENU UPDATE ‚Äî shows Login/Signup OR User Name/Profile/Logout
async function updateMenuBar() {
  const { data: sessionData } = await supabaseClient.auth.getSession();
  const menuRight = document.getElementById("menuRight");

  if (!menuRight) return;

  const isLoggedIn = sessionData?.session?.user != null;

  if (!isLoggedIn) {
    menuRight.innerHTML = `
      <a href="/user_login.html">Sign In</a>
      <a href="/user_login.html">Sign Up</a>
    `;
    return;
  }

  const email = sessionData.session.user.email;

menuRight.innerHTML = `
  <a href="/profile/index.html">Profile</a>
  <a href="#" onclick="logout()">Logout</a>
`;

document.getElementById("menuEmail").innerHTML = `${email}`;

}
</script>


<script>
const supabaseClient = window.supabase.createClient(
  'https://awtbjuiqgtdydsqzimul.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3dGJqdWlxZ3RkeWRzcXppbXVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE0OTY4MDgsImV4cCI6MjA1NzA3MjgwOH0.ES0B3O_M0dHaMHMutpkXvThMVMwIUxPqL1cvM1J2kUQ'
);

function milesBetween(lat1, lon1, lat2, lon2) {
  const toRad = (v) => (v * Math.PI) / 180;
  const R = 3958.7613; // Earth radius in miles
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
    Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

// Convert coordinates -> "City, ST" (fallback to coords if it fails)
async function reverseGeocodeCityState(lat, lon) {
  try {
    const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}`;
    const res = await fetch(url, { headers: { "Accept": "application/json" } });
    if (!res.ok) return null;

    const json = await res.json();
    const a = json.address || {};

    const city = a.city || a.town || a.village || a.hamlet || a.county || null;
    const state = a.state_code || (a.state ? String(a.state).slice(0, 2).toUpperCase() : null);

    if (!city || !state) return null;
    return `${city}, ${state}`;
  } catch (e) {
    console.warn("reverseGeocodeCityState failed:", e);
    return null;
  }
}


async function loadNearbyFairsCard(options = {}) {
  const locationLabelEl = document.getElementById("locationLabel");
  const msgEl = document.getElementById("nearbyFairsMessage");
  const resultsEl = document.getElementById("nearbyFairsResults");
  const radiusSelect = document.getElementById("radiusSelect");

  if (!locationLabelEl || !msgEl || !resultsEl || !radiusSelect) return;

  // cache (so changing miles does not re-fetch from Supabase)
  window.__nearbyFairsCache = window.__nearbyFairsCache || {
    userLat: null,
    userLon: null,
    withDistances: null,
    allFairs: null
  };

  const defaultRadius = 50;

  const clearResults = () => {
    resultsEl.innerHTML = "";
    window.__nearbyFairsCache.withDistances = null;
    window.__nearbyFairsCache.userLat = null;
    window.__nearbyFairsCache.userLon = null;
  };

  const render = (radiusMiles) => {
    const cache = window.__nearbyFairsCache;
    resultsEl.innerHTML = "";

    if (!cache.withDistances) {
      // If we don‚Äôt have a resolved location, never show fairs
      return;
    }

    const r = Number(radiusMiles || defaultRadius);
    const within = cache.withDistances.filter((f) => f._miles <= r).slice(0, 20);

    if (within.length === 0) {
      msgEl.innerText = `No fairs found within ${r} miles.`;
      return;
    }

    msgEl.innerText = `Showing fairs within ${r} miles:`;

    resultsEl.innerHTML = within.map((f) => {
      const miles = Math.round(f._miles);
      const dateLine = (f.start_date && f.end_date) ? `${f.start_date} ‚Äì ${f.end_date}` : "";
      return `
        <div style="text-align:left; padding:12px 14px; background:#111; border:1px solid #333; border-radius:10px; margin:10px 0;">
          <a href="/fairs/fair_detail.html?id=${f.id}" style="color:#d4af37; font-weight:bold; text-decoration:none;">
            ${f.name}
          </a>
          <div style="margin-top:6px; color:#f0e6d2;">
            ${f.city}, ${f.state} ¬∑ <strong>${miles} mi</strong>
            ${dateLine ? `<div style="margin-top:6px; color:#aaa;">${dateLine}</div>` : ``}
          </div>
        </div>
      `;
    }).join("");
  };

  // Only attach once
  if (!radiusSelect.__listenerAttached) {
    radiusSelect.addEventListener("change", () => render(radiusSelect.value));
    radiusSelect.__listenerAttached = true;
  }

  // Ensure default 50 selected (even if HTML gets edited later)
  if (!radiusSelect.value) radiusSelect.value = String(defaultRadius);

  // Load fairs list once (used by both gps + manual)
  const ensureAllFairsLoaded = async () => {
    if (window.__nearbyFairsCache.allFairs) return window.__nearbyFairsCache.allFairs;

    const { data, error } = await supabaseClient
      .from("renaissance_fairs")
      .select("id,name,city,state,latitude,longitude,start_date,end_date,website")
      .not("latitude", "is", null)
      .not("longitude", "is", null);

    if (error) throw new Error(error.message);

    window.__nearbyFairsCache.allFairs = (data || []);
    return window.__nearbyFairsCache.allFairs;
  };

  // MANUAL MODE (ZIP or City/State)
  if (options.source === "manual") {
    clearResults();

    const manual = window.__manualLocation || {};
    const zip = (manual.zip || "").trim();
    const city = (manual.city || "").trim();
    const state = (manual.state || "").trim().toUpperCase();

    msgEl.innerText = "Location set. Searching nearby fairs‚Ä¶";

    try {
      let userLat = null;
      let userLon = null;
      let label = "";

      if (zip) {
        label = zip;
        const geoUrl = `https://nominatim.openstreetmap.org/search?format=jsonv2&countrycodes=us&postalcode=${encodeURIComponent(zip)}&limit=1`;
        const res = await fetch(geoUrl, { headers: { "Accept": "application/json" } });
        if (!res.ok) throw new Error("ZIP lookup failed");
        const json = await res.json();
        if (!json || !json[0]) throw new Error("ZIP not found");
        userLat = Number(json[0].lat);
        userLon = Number(json[0].lon);
      } else {
        if (!(city && state)) throw new Error("Missing city/state");
        label = `${city}, ${state}`;
        const geoUrl = `https://nominatim.openstreetmap.org/search?format=jsonv2&countrycodes=us&q=${encodeURIComponent(label)}&limit=1`;
        const res = await fetch(geoUrl, { headers: { "Accept": "application/json" } });
        if (!res.ok) throw new Error("City lookup failed");
        const json = await res.json();
        if (!json || !json[0]) throw new Error("City not found");
        userLat = Number(json[0].lat);
        userLon = Number(json[0].lon);
      }

      window.__nearbyFairsCache.userLat = userLat;
      window.__nearbyFairsCache.userLon = userLon;

      locationLabelEl.innerText = label;

      const allFairs = await ensureAllFairsLoaded();
      window.__nearbyFairsCache.withDistances = allFairs
        .map((f) => ({ ...f, _miles: milesBetween(userLat, userLon, f.latitude, f.longitude) }))
        .filter((f) => Number.isFinite(f._miles))
        .sort((a, b) => a._miles - b._miles);

      render(radiusSelect.value || defaultRadius);
    } catch (e) {
      console.error(e);
      clearResults();
      locationLabelEl.innerText = "Manual location failed";
      msgEl.innerText = "Could not find that ZIP/city. Please try again.";
    }

    return;
  }

  // GPS MODE
  // If browser has no geolocation support -> DO NOT show fairs
  if (!("geolocation" in navigator)) {
    clearResults();
    locationLabelEl.innerText = "Location unavailable";
    msgEl.innerText = "Location is not available. Click Change and enter ZIP or City + State.";
    return;
  }

  msgEl.innerText = "Requesting your location‚Ä¶";

  navigator.geolocation.getCurrentPosition(
    async (pos) => {
      try {
        const userLat = pos.coords.latitude;
        const userLon = pos.coords.longitude;

        window.__nearbyFairsCache.userLat = userLat;
        window.__nearbyFairsCache.userLon = userLon;

        locationLabelEl.innerText = "Finding city‚Ä¶";
        const cityState = await reverseGeocodeCityState(userLat, userLon);
        locationLabelEl.innerText = cityState || `${userLat.toFixed(4)}, ${userLon.toFixed(4)}`;

        const allFairs = await ensureAllFairsLoaded();
        window.__nearbyFairsCache.withDistances = allFairs
          .map((f) => ({ ...f, _miles: milesBetween(userLat, userLon, f.latitude, f.longitude) }))
          .filter((f) => Number.isFinite(f._miles))
          .sort((a, b) => a._miles - b._miles);

        // AUTO: show default 50 miles immediately
        radiusSelect.value = String(defaultRadius);
        render(defaultRadius);
      } catch (e) {
        console.error(e);
        clearResults();
        msgEl.innerText = "Unexpected error loading nearby fairs.";
      }
    },
    (err) => {
      console.warn("Geolocation error:", err);
      clearResults();
      locationLabelEl.innerText = "Location blocked";
      msgEl.innerText = "Location permission is blocked. Click Change and enter ZIP or City + State.";
    },
    { enableHighAccuracy: false, timeout: 8000, maximumAge: 300000 }
  );
}


 async function loadSpotlight() {
  const card = document.getElementById("spotlightCard");
  if (!card) return;

  const { data, error } = await supabaseClient.rpc("get_next_web_spotlight");

  if (error) {
    console.error("Spotlight RPC error:", error);
    card.innerHTML = "No spotlight available.";
    return;
  }

  const item = Array.isArray(data) ? data[0] : data;

  if (!item) {
    card.innerHTML = "No spotlight available.";
    return;
  }

  card.innerHTML = `
    <h2 style="font-family:'Cinzel',serif; font-size:1.6rem; margin-bottom:12px;">
      üéâ Featured Vendor / Performer
    </h2>

    <p style="font-size:1.2rem; margin-bottom:12px; color:#d4af37; font-weight:bold;">
      ${item.name}
    </p>

    <img src="${item.photo_url}"
         alt="${item.name}"
         loading="lazy"
         decoding="async"
         style="width:100%; border-radius:10px; margin-bottom:20px;" />

    <p style="font-size:1rem; margin:0 auto 20px auto; max-width:600px;">
      ${item.description}
    </p>

    <a href="${item.website}" target="_blank" rel="noopener"
       style="display:inline-block; margin-top:6px; padding:12px 20px;
              background-color:#d4af37; color:#000; font-weight:bold;
              border-radius:8px; text-decoration:none;">
      üåê Visit Website
    </a>
  `;
}



// ‚≠ê Start spotlight after Supabase exists
loadSpotlight();
</script>
<script>

async function loadEarlyTesterCard() {
  const card = document.getElementById('earlyTesterCard');
  
  const { data: sessionData } = await supabaseClient.auth.getSession();
  const isLoggedIn = sessionData?.session?.user != null;

  let userCount = 50; // Temporary static user count

  if (isLoggedIn) {
    card.innerHTML = `
      <h3>üéâ Welcome to FairQuest!</h3>
      <p>You're logged in! Thank you for being part of our journey!</p>
      <div style="margin-top: 20px;">
        <a href="/profile/index.html" class="btn" style="background: #4CAF50; color: white;">üè∞ My Profile</a>
        <button onclick="logout()" style="margin-left: 10px; padding: 10px 20px; background: #b73239; color: white; border: none; border-radius: 8px;">üö™ Log Out</button>
      </div>
    `;
   } else {
    card.innerHTML = `
      <h3>ü™Ñ Create Your FairQuest Account</h3>
      <p>Log in or sign up to start discovering fairs, applying as a vendor or performer, and joining our growing community.</p>
      <a href="/user_login.html" class="btn" style="background: #5b2a86; color: white;">Log In / Sign Up</a>
    `;
  }

}


async function checkIfUserApplied() {
  const { data: sessionData } = await supabaseClient.auth.getSession();
  const isLoggedIn = sessionData?.session?.user != null;
  if (!isLoggedIn) return;

  const userId = sessionData.session.user.id;

  const { data: applications, error } = await supabaseClient
  .from('vendor_performer_applications')
 .select('application_type')
    .eq('user_id', userId)
    .eq('approval_status', 'approved')
    .maybeSingle();

  if (error) {
    console.error('Error checking application:', error);
    return;
  }

  if (applications) {
    if (applications.application_type === true) {
      // Performer
      document.getElementById('performerButton').innerText = 'üé≠ Performer Portal';
      document.getElementById('performerButton').href = 'vendor_performer/performer/index.html';
    } else if (applications.application_type === false) {
      // Vendor
      document.getElementById('vendorButton').innerText = 'üß∫ Vendor Portal';
      document.getElementById('vendorButton').href = 'vendor_performer/vendor/index.html';
    }
  }
}

async function logout() {
  await supabaseClient.auth.signOut();
  window.location.href = '/';
}

function trackExploreFairs(e) {
  e.preventDefault();
  gtag('event', 'fair_button_click', {
    event_category: 'navigation',
    event_label: 'Explore Fairs'
  });
  setTimeout(() => {
    window.location.href = "/fairs/explore.html";
  }, 300);
}
if (window.location.hash.includes('access_token=')) {
  document.getElementById('resetPasswordModal').style.display = 'flex';
}

async function submitNewPassword() {
  const password = document.getElementById('newPassword').value.trim();
  const confirm = document.getElementById('confirmPassword').value.trim();

  if (password.length < 6) {
    alert('Password must be at least 6 characters.');
    return;
  }

  if (password !== confirm) {
    alert('Passwords do not match.');
    return;
  }

  const { error } = await supabaseClient.auth.updateUser({ password });

  if (error) {
    alert('Error: ' + error.message);
  } else {
    alert('Password updated successfully!');
    document.getElementById('resetPasswordModal').style.display = 'none';
  }
}

function togglePassword(id) {
  const input = document.getElementById(id);
  input.type = input.type === 'password' ? 'text' : 'password';
}

function showResetPromptIfFirstLogin() {
  const hash = window.location.hash;
  if (hash.includes('access_token') && hash.includes('type=signup')) {
    document.getElementById('resetPromptModal').style.display = 'block';
  }
}

function closeResetPrompt() {
  document.getElementById('resetPromptModal').style.display = 'none';
  window.location.hash = '';
  setTimeout(() => location.reload(), 200); // Reload after hash cleared
}

showResetPromptIfFirstLogin();

supabaseClient.auth.getUser().then(({ data }) => {
  const email = data?.user?.email;
  if (email) {
    document.getElementById('inviteEmail').textContent = `Set a password for: ${email}`;
  }
});

// Start everything
loadEarlyTesterCard();
checkIfUserApplied();
updateMenuBar();
loadNearbyFairsCard();




</script>
<script>
async function requireLoginAndRedirect(destination) {
  const { data: sessionData } = await supabaseClient.auth.getSession();
  const isLoggedIn = sessionData?.session?.user != null;

  if (isLoggedIn) {
    window.location.href = destination;
  } else {
    alert('üîí Please log in or sign up first!');
    window.location.href = '/user_login.html?redirect=' + encodeURIComponent(destination);
  }
}
</script>

<div id="resetPromptModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.7); z-index:9999;">
  <div style="background:#fff; color:#000; padding:30px; border-radius:8px; max-width:400px; margin:100px auto; text-align:center;">
    <h3>Welcome!</h3>
<p id="inviteEmail">Setting up your account...</p>
    <a href="/profile/reset-password.html" class="btn" style="margin-top: 20px;">Set Password</a>
    <br><br>
    <button onclick="closeResetPrompt()">Close</button>
  </div>
</div>

</body>
</html>
