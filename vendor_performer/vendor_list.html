<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vendor List | FairQuest</title>
  <link rel="stylesheet" href="/css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <style>
    body{
      background-color:#000;
      color:#f0e6d2;
      font-family:'Domine', serif;
      padding:20px;
      text-align:center;
    }

    h1{
      font-family:'Cinzel', serif;
      margin-bottom:12px;
    }

    .home-button{
      display:inline-block;
      padding:10px 18px;
      background:#bb9457;
      color:#000;
      text-decoration:none;
      border-radius:8px;
      font-weight:bold;
      font-family:'Cinzel', serif;
      margin-bottom:18px;
    }
    .home-button:hover{ background:#d4af6a; }

    .filters{
      margin-bottom:20px;
      display:flex;
      justify-content:center;
    }
    .filters input{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.14);
      font-size:16px;
      background:rgba(255,255,255,0.08);
      color:rgba(255,255,255,0.92);
      min-width:min(520px,92vw);
      outline:none;
    }
    .filters input::placeholder{ color:rgba(255,255,255,0.65); }

    .vendor-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
      gap:20px;
      max-width:1200px;
      margin:0 auto;
    }

    .vendor-card{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      color:rgba(255,255,255,0.92);
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 10px 24px rgba(0,0,0,0.35);
    }

    .card-media{
      width:100%;
      height:210px;
      background:rgba(255,255,255,0.05);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .card-media img{
      max-width:100%;
      max-height:100%;
      object-fit:contain; /* no crop */
      display:block;
    }

    .card-body{
      padding:16px 16px 18px;
      text-align:left;
    }

    .card-title{
      font-family:'Cinzel', serif;
      text-align:center;
      margin:0 0 12px;
      font-size:22px;
      line-height:1.1;
      color:#f0e6d2;
    }

    .card-actions{
      display:flex;
      gap:10px;
      justify-content:center;
      margin:10px 0 14px;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border:0;
      border-radius:10px;
      padding:10px 14px;
      font-weight:700;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .btn-primary{ background:#bb9457; color:#000; }
    .btn-disabled{
      background:rgba(255,255,255,0.10);
      color:rgba(255,255,255,0.55);
      cursor:not-allowed;
    }

    .card-desc{
      color:rgba(255,255,255,0.82);
      margin:0;
    }
  </style>
</head>
<body>

  <h1>üõç Vendor List</h1>

<a href="../index.html" class="home-button">üè† Return to Main Site</a>
  <div class="filters">
    <input type="text" id="searchInput" placeholder="üîé Search Vendor Name" />
  </div>

  <div class="vendor-grid" id="vendorGrid"></div>

  <script>
    const supabaseClient = window.supabase.createClient(
      'https://awtbjuiqgtdydsqzimul.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3dGJqdWlxZ3RkeWRzcXppbXVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE0OTY4MDgsImV4cCI6MjA1NzA3MjgwOH0.ES0B3O_M0dHaMHMutpkXvThMVMwIUxPqL1cvM1J2kUQ'
    );

    let vendors = [];

    function normalizeUrl(url){
      if(!url) return null;
      const trimmed = String(url).trim();
      if(!trimmed) return null;
      if(trimmed.startsWith('http://') || trimmed.startsWith('https://')) return trimmed;
      return 'https://' + trimmed;
    }

    async function loadVendors(){
      const { data, error } = await supabaseClient
        .from('vendor_performer_applications')
        .select('id, name, description, photo_url, website')
        .or('application_type.is.false,application_type.is.null')
        .order('name', { ascending: true });

      if (error || !data) {
        document.getElementById('vendorGrid').innerHTML = '<p>‚ö†Ô∏è Failed to load vendors.</p>';
        return;
      }

      vendors = data;
      renderVendors();
    }

    function renderVendors(){
      const searchQuery = document.getElementById('searchInput').value.toLowerCase();
      const container = document.getElementById('vendorGrid');

      container.innerHTML = '';

      vendors
        .filter(v => (v.name || '').toLowerCase().includes(searchQuery))
        .forEach(vendor => {
          const websiteUrl = normalizeUrl(vendor.website);

          container.innerHTML += `
            <div class="vendor-card">
              <div class="card-media">
                ${vendor.photo_url ? `<img src="${vendor.photo_url}" alt="${vendor.name}">` : ``}
              </div>

              <div class="card-body">
                <h2 class="card-title">${vendor.name}</h2>

                <div class="card-actions">
                  ${
                    websiteUrl
                      ? `<a class="btn btn-primary" href="${websiteUrl}" target="_blank" rel="noopener noreferrer">Website</a>`
                      : `<span class="btn btn-disabled">Website</span>`
                  }
                </div>

                <p class="card-desc"><strong>Description:</strong> ${vendor.description || 'No description'}</p>
              </div>
            </div>
          `;
        });

      if (container.innerHTML.trim() === '') {
        container.innerHTML = '<p>‚ùå No vendors found.</p>';
      }
    }

    document.getElementById('searchInput').addEventListener('input', renderVendors);

    loadVendors();
  </script>

</body>
</html>